<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> concurve R Package | Less Likely </title>
<!-- favicons --><link rel="shortcut icon" type="image/x-icon" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/apple-touch-icon-180x180.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="https://github.com/zadrafi/concurve/raw/master/pkgdown/favicon/apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using Stata">
<meta property="og:description" content="A simple guide on how to produce consonance functions in Stata.">
<meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/7/79/Stata_logo_med_blue.png,concurve R package hex logo">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-116104766-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116104766-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand"><img src="https://data.lesslikely.com/concurve/reference/figures/logo.svg" id="package-logo" align="left" width="35"><a class="navbar-link" href="../index.html">concurve</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/examples.html">Examples in R</a>
    </li>
    <li>
      <a href="../articles/survival.html">Survival Modeling</a>
    </li>
    <li>
      <a href="../articles/meta-analysis.html">Meta-Analysis Examples</a>
    </li>
    <li>
      <a href="../articles/likelihood.html">Profile Likelihoods</a>
    </li>
    <li>
      <a href="../articles/bootstrap.html">Bootstrap and Consonance Functions</a>
    </li>
    <li>
      <a href="../articles/bayes.html">Comparison to Bayesian Posteriors</a>
    </li>
    <li>
      <a href="../articles/stata.html">Using Stata</a>
    </li>
    <li>
      <a href="../articles/customizing.html">Customizing Plots</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/casestudies.html">Case Studies</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tools
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/svalues.html">S-value Calculator</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../news/index.html">Updates</a>
    </li>
    <li>
      <a href="../articles/wishlist.html">Wish List</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/zadrafi/concurve">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/dailyzad">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="stata_files/header-attrs-2.3/header-attrs.js"></script><script src="stata_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using Stata</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/zadrafi/concurve/blob/master/vignettes/stata.Rmd"><code>vignettes/stata.Rmd</code></a></small>
      <div class="hidden name"><code>stata.Rmd</code></div>

    </div>

    
    
<p>Although <code>concurve</code> was originally designed to be used in <code>R</code>, it is possible to achieve very similar results in <code>Stata</code>. We can use some datasets that are built into <code>Stata</code> to show how to achieve this.</p>
<p>First, let’s load the <em>auto2</em> dataset which contains data about cars and their characteristics.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r">sysuse auto2</pre></body></html></div>
<p>Browse the dataset in your databrowser to get more familiar with some of the variables. Let’s say we’re interested in the relationship between miles per gallon and price. We could fit a very simple linear model to assess that relationship.</p>
<p>First, let’s visualize the data with a scatterplot.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r">twoway (scatter price mpg)</pre></body></html></div>
<br><center>
<img src="figures/statascatter.png" align="center" width="550">
</center>
<p><br> That’s what our data looks like. Clearly there seems to be an inverse relationship between miles per gallon and price.</p>
<p>Now we could fit a very simple linear model with miles per gallon being the predictor and price being the outcome and get some estimates of the relationship.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r">regress price mpg </pre></body></html></div>
<br><center>
<img src="figures/stataoutput.png" align="center" width="550">
</center>
<p><br> That’s what our output looks like.</p>
<p>Our output also gives us 95% consonance (confidence) intervals by default. The interval includes values as low as -344 and as high as -133. Here’s what our model looks graphed.</p>
<br><center>
<img src="figures/statareg.png" align="center" width="550">
</center>
<p><br></p>
<p>Unfortunately, the program only gives us one interval at 95% and we’re interested in seeing every single interval at every level, and plotting it to form a function.</p>
<p>Here’s the code that we’ll be using to achieve that.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r">
postfile topost level pvalue svalue lointerval upinterval using my_new_data, replace
     
forvalues i = 10/99.9 { 
      quietly regress price mpg, level(`i')
      matrix E = r(table)
      matrix list E
      post topost (`i') (1-`i'/100) ( ln(1-`i'/100)/ln(2) * -1) (E[5,1]) (E[6,1])
    } 
    
postclose topost
use my_new_data, clear
list

twoway (pcscatter level lointerval level upinterval), 
ytitle(Consonance Level (%)) xtitle(Consonance Limits) ///
title(Consonance Curve) 
subtitle(A function comprised of several consonance intervals at various levels.)</pre></body></html></div>
<p>That’s a lot and may seem intimidating at first, but I’ll explain it line by line.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r">postfile topost level pvalue svalue lointerval upinterval using my_new_data, replace</pre></body></html></div>
<p>“<strong>postfile</strong>” is the command that will be responsible for pasting the data from our overall loop into a new dataset. Here, we are telling <code>Stata</code> that the internal <code>Stata</code> memory used to hold these results (the post) will be named “<strong>topost</strong>” and that it will have five variables, “<strong>level</strong>”, “<strong>pvalue</strong>”, “<strong>svalue</strong>”, “<strong>lointerval</strong>”, and “<strong>upinterval</strong>.”</p>
<ul>
<li><p>“<strong>level</strong>” will contain the consonance level that corresponds to the limits of the interval, with “<strong>lointerval</strong>” being the lower bound of the interval and “<strong>upinterval</strong>” being the upper bound.</p></li>
<li><p>“<strong>pvalue</strong>”is computed by taking 1 - “<strong>level</strong>”, which is alpha.</p></li>
<li><p>“<strong>svalue</strong>”is computed by taking the <span class="math inline">\(-log_{2}\)</span> of the computed P-value, and this column will be used to plot the surprisal function.</p></li>
<li><p>“<strong>my_new_data</strong>” is the filename that we’ve assigned to our new dataset.</p></li>
<li><p>“<strong>replace</strong>” indicates that if there is an existing filename that already exists, we’re willing to relace it.</p></li>
</ul>
<p>Here are the next few major lines</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r">forvalues i = 10/99.9 { 
      quietly regress price mpg, level(`i')
      matrix E = r(table)
      matrix list E
      post topost (`i') (1-`i'/100) ( ln(1-`i'/100)/ln(2) * -1) (E[5,1]) (E[6,1])
    } </pre></body></html></div>
<p>The command “<strong>forvalues</strong>” is responsible for taking a set of numbers that we provide it, and running the contents within the braces through those numbers. So here, we’ve set the local macro “<strong>i</strong>” to contain numbers between 10 and 99.99 for our consonance levels. Why 10? <code>Stata</code> cannot compute consonance intervals lower than 10%.</p>
<p>Our next line contains the actual contents of what we want to do. Here, it says that we will run a simple linear regression where mpg is the predictor and where price is the outcome, and that the outputs for each loop will be suppressed, hence the “<strong>quiet</strong>.”</p>
<p>Then, we have the command “<strong>level</strong>” with the local macro “<strong>i</strong>” inside of it. As you may already know, “<strong>level</strong>” dictates the consonance level that <code>Stata</code> provides us. By default, this is set to 95%, but here, we’ve set it “<strong>i</strong>”, which we established via “<strong>forvalues</strong>” as being set to numbers between 10 and 99.</p>
<p>The next line two lines</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r">      matrix E = r(table)
      matrix list E</pre></body></html></div>
<p>indicate that we will take variables of a certain class r(), (this class contains the interval bounds we need) and place them within a matrix called E. Then we will list the contents of this matrix.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r">post topost (`i') (1-`i'/100) ( ln(1-`i'/100)/ln(2) * -1) (E[5,1]) (E[6,1])</pre></body></html></div>
<p>From the contents of this matrix list, we will take the estimates from the <em>fifth</em> and <em>sixth</em> rows (look at the last two paranthesis of this line of code above and then the image below) in the <em>first</em> column which contain our consonance limits, with the fifth row containing the lower bound of the interval and the sixth containing the upper bound.</p>
<br><center>
<img src="figures/matrix.png" align="center" width="350">
</center>
<p><br></p>
<p>We will place the contents from the fifth row into the second variable we set originally for our new dataset, which was “<strong>lointerval</strong>.” The contents of the sixth row will be placed into “<strong>upinterval</strong>.”</p>
<p>All potential values of “<strong>i</strong>” (10-99) will be placed into the first variable that we set, “<strong>level</strong>”. From this first variable, we can compute the second variable we set up, which was “<strong>Pvalue</strong>” and we’ve done that here by subtracting “<strong>level</strong>” from 1 and then dividing the whole equation by 100, so that our P-value can be on the proper scale. Our third variable, which is the longest, computes the “<strong>Svalue</strong>” by using the previous variable, the “<strong>Pvalue</strong>” and taking the <span class="math inline">\(-log_{2}\)</span> of it.</p>
<p>The relationships between the variables on this line and the variables we set up in the very first line are dictated by the order of the commands we have set, and therefore they correspond to the same order.</p>
<p>“post topost” is writing the results from each loop as new observations in this data structure.</p>
<p>With that, our loop has concluded, and we can now tell <code>Stata</code> that “post” is no longer needed</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">postclose topost</pre></body></html></div>
<p>We then tell <code>Stata</code> to clear its memory to make room for the new dataset we just created and we can list the contents of this new dataset.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r">use my_new_data, clear
list</pre></body></html></div>
<p>Now we have an actual dataset with all the consonance intervals at all the levels we wanted, ranging from 10% all the way up to 99%.</p>
<p>In order to get a function, we’ll need to be able to graph these results, and that can be tricky since for each observation we have one y value (the consonance level), and two x values, the lower bound of the interval and the upper bound of the interval.</p>
<p>So a typical scatterplot will not work, since <code>Stata</code> will only accept one x value. To bypass this, we’ll have to use a paired-coordinate scatterplot which will allow us to plot two different y variables and two different x variables.</p>
<p>Of course, we don’t need two y variables, so we can set both options to the variable “<strong>level</strong>”, and then we can set our first x variable to “<strong>lointerval</strong>” and the second x variable to “<strong>upinterval</strong>.”</p>
<p>This can all be done with the following commands, which will also allow us to set the title and subtitle of the graph, along with the titles of the axes.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r">twoway (pcscatter level lointerval level upinterval), 
ytitle(Consonance Level (%)) xtitle(Consonance Limits) ///
title(Consonance Curve) 
subtitle(A function comprised of several consonance intervals at various levels.)</pre></body></html></div>
<p>However, I would recommend using the menu to customize the plots as much as possible. Simply go to the <strong>Graphics</strong> menu and select <strong>Twoway Graphs</strong>. Then create a new plot definition, and select the <strong>Advanced plots</strong> and choose a paired coordinate scatterplot and fill in the y variables, both of which will be “<strong>levels</strong>” and the x variables, which will be “<strong>lointerval</strong>” and “<strong>upinterval</strong>”.</p>
<br><center>
<img src="figures/graphmenu.png" align="center" width="600">
</center>
<p><br></p>
<p>So now, here’s what our consonance function looks like.</p>
<br><center>
<img src="figures/statacon.png" align="center" width="600">
</center>
<p><br> And here’s what our surprisal function looks like.</p>
<br><center>
<img src="figures/statasurp.png" align="center" width="600">
</center>
<p><br> It looks slighly better when the y-axis is transformed logarithmically…</p>
<br><center>
<img src="figures/statasurplog.png" align="center" width="600">
</center>
<p><br> …but then we lose our ability to differentiate between the effects contained in intervals with higher bits of information and S-values are already logarithmically scaled.</p>
<p>It’s clear that in both plots, we’re missing values of intervals with a consonance level of less than 10%, but unfortunately, this is the best <code>Stata</code> can do, and what we’ll have to work with. It may not look as pretty as an output from <code>R</code>, but it’s far more useful than blankly staring at a 95% interval and thinking that it is the only piece of information we have regarding compatibility of different effect estimates.</p>
<p>The code that I have pasted above can be used for most commands in <code>Stata</code> that have an option to calculate a consonance level. Thus, if there’s an option for “<strong>level</strong>”, then the commands above will work to produce a dataset of several consonance intervals.</p>
<p>For example, if we wished to fit a generalized linear model, here’s what our code would look like.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r">postfile topost level pvalue svalue lointerval upinterval using my_new_data, replace
     
forvalues i = 10/99.9 { 
      quietly glm price mpg, level(`i')
      matrix E = r(table)
      matrix list E
      post topost (`i') (1-`i'/100) ( ln(1-`i'/100)/ln(2) * -1) (E[5,1]) (E[6,1])
    } 
    
postclose topost
use my_new_data, clear
list

twoway (pcscatter level lointerval level upinterval), 
ytitle(Confidence Level (%)) xtitle(Confidence Limits) ///
title(Consonance Curve) 
subtitle(A function comprised of several consonance intervals at various levels.)</pre></body></html></div>
<p>We simply replace the first line within the loop with our intended command, just as I’ve replaced</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r">regress price mpg</pre></body></html></div>
<p>with</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r">glm price mpg</pre></body></html></div>
<p>If we wanted fit something more complex, like a multilevel mixed model that used restricted maximum likelihood, here’s what our code would look like</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r">postfile topost level pvalue svalue lointerval upinterval using my_new_data, replace
     
forvalues i = 10/99.9 { 
      quietly mixed outcome predictor, reml level(`i')
      matrix E = r(table)
      matrix list E
      post topost (`i') (1-`i'/100) ( ln(1-`i'/100)/ln(2) * -1) (E[5,1]) (E[6,1])
    } 
    
postclose topost
use my_new_data, clear
list

twoway (pcscatter level lointerval level upinterval), 
ytitle(Confidence Level (%)) xtitle(Confidence Limits) ///
title(Consonance Curve) 
subtitle(A function comprised of several consonance intervals at various levels.)</pre></body></html></div>
<p>Basically, our code doesn’t really change that much and with only a few lines of it, we are able to produce graphical tools that can better help us interpret the wide range of effect sizes that are compatible with the model and its assumptions.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://lesslikely.com/">Zad Rafi</a>, <a href="https://www.researchgate.net/profile/Andrew_Vigotsky">Andrew D. Vigotsky</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '328a30be91979e947c28ffd52f604eda',
    indexName: 'lesslikely-concurve',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
